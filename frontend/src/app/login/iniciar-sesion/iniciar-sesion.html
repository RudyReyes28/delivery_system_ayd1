<div class="login-container">
  <!-- FORMULARIO DE LOGIN PRINCIPAL -->
  <mat-card class="login-card" *ngIf="!mostrarDialogToken">
    <mat-card-header>
      <mat-card-title>Iniciar Sesión</mat-card-title>
      <mat-card-subtitle>Ingresa tus credenciales</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
        
        <!-- Campo Username -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Usuario</mat-label>
          <input matInput 
                 type="text" 
                 formControlName="username">
          <mat-icon matSuffix>account_circle</mat-icon>
          <mat-error *ngIf="username?.hasError('required')">
            El usuario es requerido
          </mat-error>
        </mat-form-field>

        <!-- Campo Contraseña -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Contraseña</mat-label>
          <input matInput 
                 [type]="hidePassword ? 'password' : 'text'" 
                 formControlName="password"
                 placeholder="Tu contraseña">
          <button mat-icon-button 
                  matSuffix 
                  (click)="hidePassword = !hidePassword"
                  type="button"
                  [attr.aria-label]="'Hide password'" 
                  [attr.aria-pressed]="hidePassword">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="password?.hasError('required')">
            La contraseña es requerida
          </mat-error>
          <mat-error *ngIf="password?.hasError('minlength')">
            La contraseña debe tener al menos 6 caracteres
          </mat-error>
        </mat-form-field>

        <!-- Botón de Login -->
        <button mat-raised-button 
                color="primary" 
                type="submit"
                class="login-button full-width"
                [disabled]="loginForm.invalid || isLoading">
          <mat-icon *ngIf="isLoading">
            <mat-spinner diameter="20"></mat-spinner>
          </mat-icon>
          <span *ngIf="!isLoading">Iniciar Sesión</span>
          <span *ngIf="isLoading">Cargando...</span>
        </button>

        <!-- Enlaces adicionales -->
        <div class="additional-links">
          <a mat-button routerLink="/recuperar-cuenta">¿Olvidaste tu contraseña?</a>
          <a mat-button routerLink="/crear-usuario">¿No tienes cuenta? Regístrate</a>
        </div>

      </form>
    </mat-card-content>
  </mat-card>

  <!-- DIALOG DE VERIFICACIÓN DE TOKEN -->
  <mat-card class="token-card" *ngIf="mostrarDialogToken">
    <mat-card-header class="token-header">
      <mat-card-title>
        <mat-icon>security</mat-icon>
        Verificación de Seguridad
      </mat-card-title>
      <mat-card-subtitle>Ingresa el código enviado a tu correo</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <div class="token-info">
        <p>Se ha enviado un código de verificación de 6 dígitos</p>
        <p><strong>Usuario:</strong> {{ usuarioActual }}</p>
      </div>

      <form [formGroup]="tokenForm" (ngSubmit)="verificarToken()" class="token-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Código de Verificación</mat-label>
          <input matInput 
                 type="text" 
                 formControlName="token"
                 placeholder="123456"
                 maxlength="6">
          <mat-icon matSuffix>vpn_key</mat-icon>
          <mat-error *ngIf="token?.hasError('required')">
            El código es requerido
          </mat-error>
          <mat-error *ngIf="token?.hasError('minlength') || token?.hasError('maxlength')">
            El código debe tener exactamente 6 dígitos
          </mat-error>
          <mat-error *ngIf="token?.hasError('incorrect')">
            Código incorrecto
          </mat-error>
        </mat-form-field>

        <div class="dialog-info">
          <mat-icon color="accent">info</mat-icon>
          <span>Revisa tu bandeja de entrada y carpeta de spam</span>
        </div>

        <!-- Botones de acción -->
        <div class="token-actions">
          <button mat-raised-button 
                  color="primary" 
                  type="submit"
                  class="verify-button"
                  [disabled]="tokenForm.invalid || isVerificandoToken">
            <mat-spinner diameter="20" *ngIf="isVerificandoToken"></mat-spinner>
            <span *ngIf="!isVerificandoToken">Verificar</span>
            <span *ngIf="isVerificandoToken">Verificando...</span>
          </button>

          <button mat-button 
                  color="warn"
                  (click)="cerrarDialogToken()"
                  [disabled]="isVerificandoToken">
            Cancelar
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>